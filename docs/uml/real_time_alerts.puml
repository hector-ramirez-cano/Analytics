@startuml realTimeAlerts

actor "Usuario" as User
box "Frontend" #ffdcdcff
boundary "UI" as UI
end box

' Define controller and model lifelines
' Backend
box "Controller" #caade6ff
control "WebSocket" as WebSocket
end box

box "Model" #99c4ad
boundary "Fact\nGathering" as FactGatheringBackend
entity "Syslog\nBackend" as SyslogBackend
entity "Alert\nBackend" as AlertBackend
Database "Database" as Database
end box


box "Telegram"  #9aceffff
entity Telegram as Telegram
end box

== Subscription ==
User -> UI : Inicio
UI -> WebSocket : registro
WebSocket -> AlertBackend : register_listener(queue)

== Fact event loop ==
loop Corutine
    FactGatheringBackend -> AlertBackend : eval_facts(queue)
    AlertBackend -> AlertBackend : __eval_rules()
    AlertBackend -> AlertBackend : raise_alert()
    AlertBackend -> Database : insert_alert(AlertEvent)
    Database --> AlertBackend : alert_id

end

AlertBackend -> Telegram : notify(alert)
AlertBackend -> Database : notify(alert)
AlertBackend -> WebSocket : notify(alert)
WebSocket -> UI : notify
UI -> User : notify

Telegram -> User : notify(alert)
@enduml
